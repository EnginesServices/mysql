#!/bin/sh

. /home/engines/functions/checks.sh\r\nrequired_values=\"database_name db_username db_password\"\r\ncheck_required_values\r\n\r\nBTICK='`'\r\n\r\nE_BADARGS=65\r\nMYSQL=`which mysql`\r\n\r\necho \"set password for '\"$db_username\"'@'%' = PASSWORD('\"$db_password\"');\"  >/tmp/rm_user\t\r\n\r\n\r\nif ! test -z $full_access\r\n then\r\n   if test $full_access = true\r\n \tthen\r\n \t  echo \"UPDATE mysql.user SET Super_Priv='Y' WHERE user='$db_username' AND host='%';\"  >>/tmp/rm_user\r\n   elif test $full_access = grant \r\n     then\r\n      echo \"UPDATE mysql.user SET Super_Priv='N' WHERE user='$dbusername' AND host='%';\"\r\n      echo  \"GRANT ALL PRIVILEGES ON ${BTICK}$database_name${BTICK}.* TO '$db_username'@'%' IDENTIFIED BY '$db_password' WITH GRANT OPTION;\"  >>/tmp/rm_user\r\n    else\t     \r\n \t  echo \"REVOKE GRANT ON ${BTICK}$database_name${BTICK}.* TO '$db_username'@'%' IDENTIFIED BY '$db_password' ;\"  >>/tmp/rm_user\r\n    fi\r\n fi\r\n\r\nmysql -urma  -e </tmp/rm_user &> /tmp/res\r\nsucess=$?\r\nres=`cat /tmp/res`\r\n\r\necho $res | grep -v ERROR\r\n \r\nif test $! -eq 0\r\n then \r\n    rm /tmp/rm_user\r\n\techo \"Success\"\r\n\texit 0\r\nfi\r\n\t\r\necho \"Error:$sucess $res\"\r\necho  With $SQL\r\nexit 127\r\n\r\n
