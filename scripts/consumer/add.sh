#!/bin/sh

. /home/engines/functions/checks.sh\r\nBTICK='`'\r\n\r\nrequired_values=\"database_name db_username db_password collation\"\r\ncheck_required_values\r\n\r\n\r\nchar_set=`echo $collation | cut -f1 -d_`\r\n\r\nif test -z \"$char_set\"\r\n then\r\n \tchar_set=utf8\r\nfi\r\n\r\necho \"CREATE DATABASE IF NOT EXISTS ${BTICK}$database_name${BTICK}   DEFAULT CHARACTER SET $char_set  DEFAULT COLLATE $collation ;\" >/tmp/add_user\r\necho \"GRANT ALL  PRIVILEGES ON ${BTICK}$database_name${BTICK}.* TO '$db_username'@'%' IDENTIFIED BY '$db_password';\" >>/tmp/add_user\r\necho \"Grant Create User on *.* to '$db_username'@'%';\" >>/tmp/add_user\r\necho \"FLUSH PRIVILEGES;\" >>/tmp/add_user\r\nif ! test -z $full_access\r\n then\r\n\tif test $full_access = true\r\n  \t then\r\n \t   echo \"UPDATE mysql.user SET Super_Priv='Y' WHERE user='$dbusername' AND host='%';\"  >>/tmp/add_user \r\n    elif test $full_access = grant \r\n \t then\r\n \t   echo \"GRANT ALL  PRIVILEGES ON ${BTICK}$database_name${BTICK}.* TO '$db_username'@'%' IDENTIFIED BY '$db_password' WITH GRANT OPTION;\"  >>/tmp/add_user\r\n \tfi\r\n fi\r\n\r\nmysql -urma  < /tmp/add_user &> /tmp/res\r\nsucess=$?\r\nres=`cat /tmp/res`\r\n\r\necho $res | grep -v ERROR\r\n \r\nif test $? -eq 0\r\n then \r\n\techo \"Success\"\r\n\trm /tmp/add_user\r\n\texit 0\r\nfi\r\n\t\r\necho \"Error:$sucess res \"\r\necho with $SQL\r\nexit 127
